!function(n){window.ERP_Uploader=function(e,t,i,r,a,o,s,l){this.container=i,this.browse_button=t,n("#"+t).length&&(this.uploader=new plupload.Uploader({dragdrop:!0,drop_element:r,runtimes:"html5,html4",browse_button:t,container:i,multipart_params:{action:e,file_id:n("#"+t).data("file_id"),_wpnonce:wpErp.nonce},max_file_size:s+"kb",url:wpErp.plupload.url+"&type="+a,flash_swf_url:wpErp.flash_swf_url,filters:[{title:"Allowed Files",extensions:o}],views:{list:!0,thumbs:!0,active:"thumbs"},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap"}),this.uploader.bind("Init",n.proxy(this,"init")),this.uploader.bind("FilesAdded",n.proxy(this,"added")),this.uploader.bind("QueueChanged",n.proxy(this,"upload")),this.uploader.bind("UploadProgress",n.proxy(this,"progress")),this.uploader.bind("Error",n.proxy(this,"error")),this.uploader.bind("FileUploaded",n.proxy(this,"uploaded")),this.uploader.init(),this.callback=l,n("#"+i).on("click","a.attachment-delete",n.proxy(this.removeAttachment,this)))},ERP_Uploader.prototype={init:function(e,t){},executeFunctionByName:function(e,t,i){if(void 0===e)return!1;i=[].slice.call(arguments).splice(2);for(var r=e.split("."),a=r.pop(),o=0;o<r.length;o++)t=t[r[o]];return"function"==typeof t[a]&&t[a].apply(t,i)},added:function(e,t){n("#"+this.container).find(".erp-attachment-upload-filelist");var i=n("#"+this.container).find(".erp-attachment-list");n.each(t,function(e,t){i.append('<li class="erp-image-wrap thumbnail '+t.id+'"><div class="attachment-name erp-img-progress"><div class="upload-item" id="'+t.id+'"><div class="progress progress-striped active"><div class="bar"></div></div></div></div></li>')}),e.refresh(),e.start()},upload:function(e){this.uploader.start()},progress:function(e,t){var i=n("#"+t.id);n(".bar",i).css({width:t.percent+"%"}),n(".percent",i).html(t.percent+"%")},error:function(e,t){n("#"+this.container).find("#"+t.file.id).remove();var i="";switch(t.code){case-600:i="The file you have uploaded exceeds the file size limit. Please try again.";break;case-601:i="You have uploaded an incorrect file type. Please try again.";break;default:i="Error #"+t.code+": "+t.message}alert(i),this.uploader.refresh()},uploaded:function(e,t,i){var r=n.parseJSON(i.response),a={up:e,file:t,response:i};!1===this.executeFunctionByName(this.callback.after_uploaded,window,a)&&(n("#"+t.id+" b").html("100%"),n("#"+t.id).remove(),r.success?n("."+t.id).replaceWith(r.data):alert(r.error))},removeAttachment:function(e){e.preventDefault();var t=this,i=n(e.currentTarget);if(confirm(wpErp.confirmMsg)){var r={attach_id:i.data("attach_id"),custom_attr:i.closest(".erp-image-wrap").find(".erp-file-mime").data(),_wpnonce:wpErp.nonce,action:"erp_file_del"};jQuery.post(wpErp.ajaxurl,r,function(){i.parent().parent().remove(),t.uploader.refresh()})}}}}(jQuery);